<script>
    document.title = 'TechFi - Writer';
</script>
{{!< default}}

<script>
    document.title = 'TechFi - Writer';
</script>
<iframe id="writer-page" class="custom-iframe" src="" title="admin-news"></iframe>

<script>
    let integrationMemberJwt = localStorage.getItem(INTEGRATION_JWT_MEMBER_KEY);

    if (!integrationMemberJwt) {
        let currentUrl = window.location.href;
        httpGet('#/ghost/signout', {}, {});
        // window.location.replace(currentUrl);
        window.location.replace('#/portal/signup');

    } else {
        var pageWriter = getWriterUrl();

        function addCode() {
            document.getElementById('custom-profile').setAttribute('src', pageWriter);
        }

        var elementId = 'writer-page';
        var attrKey = 'src';
        var attrValue = pageWriter;

        addValueToAttr(elementId, attrKey, attrValue);

        async function checkSameUserUrl() {
            var host = window.location.host;
            var protocol = location.protocol;
            var userInfoSlug = '/ghost/api/admin/users/me/?include=roles';
            var userInfoUrl = `${protocol}//${host}${userInfoSlug}`;

            var integrationProfileUrl = TechFiIntegrationBaseURL + '/users/profiles';
            var jwt = localStorage.getItem(INTEGRATION_JWT_MEMBER_KEY);
            // let url = 'https://staging.techfi.tech/ghost/api/admin/users/me/?include=roles';
            let user = httpGet(userInfoUrl, {}, {});
            user= JSON.parse(user);
            let header = {
                Authorization: `Bearer ${jwt}`
            };
            let userIntegration = httpGet(integrationProfileUrl, {}, header);
            userIntegration= JSON.parse(userIntegration);
            if (!(userIntegration && user && user.users && user.users[0] && user.users[0].id == userIntegration.profile.author_id)) {
                console.log(user.users[0].id)
                console.log(userIntegration.profile.author_id)
                var url = `${protocol}//${host}/ghost/#/signout`;
                addValueToAttr(elementId, attrKey, url);
            }
        }

        checkSameUserUrl();
    }

</script>